<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>数学发展史图谱</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Microsoft YaHei', sans-serif;
            background: #f5f7fa;
            overflow: hidden;
        }
        #container {
            display: flex;
            flex-direction: column;
            width: 100vw;
            height: 100vh;
        }
        #header {
            text-align: center;
            padding: 8px 15px;
            background: #fff;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 10;
        }
        #main {
            flex: 1;
            width: 100%;
            height: calc(100% - 100px);
        }
        #timeline {
            height: 40px;
            background: #fff;
            border-top: 1px solid #ddd;
            padding: 5px 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .time-marker {
            position: relative;
            text-align: center;
            flex: 1;
            max-width: 120px;
        }
        .time-label {
            font-weight: bold;
            color: #333;
            margin-bottom: 3px;
            font-size: 11px;
        }
        .time-line {
            height: 3px;
            background: linear-gradient(90deg, #5470c6, #91cc75, #fac858, #6a0dad, #ee6666, #73c0de, #9a60b4);
            border-radius: 2px;
            margin: 0 8px;
        }
        .time-pointer {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 8px;
            height: 8px;
            background: #333;
            border-radius: 50%;
        }
        .legend-container {
            display: flex;
            justify-content: center;
            margin-top: 5px;
            flex-wrap: wrap;
            gap: 10px;
        }
        .legend-item {
            display: flex;
            align-items: center;
        }
        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 3px;
            margin-right: 3px;
        }
        .controls {
            margin-top: 5px;
            display: flex;
            justify-content: center;
            gap: 8px;
        }
        .control-btn {
            padding: 4px 8px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }
        .control-btn:hover {
            background: #f0f0f0;
        }
        h1 {
            margin: 5px 0;
            font-size: 20px;
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="header">
            <h1>数学发展路径图谱</h1>
            <div class="legend-container">
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #5470c6;"></div>
                    <span>几何</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #91cc75;"></div>
                    <span>代数</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #fac858;"></div>
                    <span>分析</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #6a0dad;"></div>
                    <span>基础数学</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #ee6666;"></div>
                    <span>代数交叉</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #73c0de;"></div>
                    <span>分析交叉</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #9a60b4;"></div>
                    <span>21世纪新领域</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #ff0000;"></div>
                    <span>未解决问题</span>
                </div>
            </div>

        </div>
        <div id="main"></div>
        <div id="timeline">
            <div class="time-marker">
                <div class="time-label">公元前300年</div>
            </div>
            <div class="time-marker">
                <div class="time-label">17世纪</div>
            </div>
            <div class="time-marker">
                <div class="time-label">18世纪</div>
            </div>
            <div class="time-marker">
                <div class="time-label">19世纪</div>
            </div>
            <div class="time-marker">
                <div class="time-label">20世纪初</div>
            </div>
            <div class="time-marker">
                <div class="time-label">20世纪中后期</div>
            </div>
            <div class="time-marker">
                <div class="time-label">21世纪</div>
            </div>
        </div>
    </div>
    
    <script>
        // 定义节点：每个理论是一个节点，添加时间属性
        const nodes = [
            // 基础数学分支
            { id: 'foundation-logic', name: '逻辑学', category: 'foundation', time: 0, x: 0, y: -3 },
            { id: 'foundation-numbers', name: '数字系统', category: 'foundation', time: 0, x: 0.5, y: -3.2 },
            { id: 'foundation-set', name: '集合论', category: 'foundation', time: 3, x: 3, y: -3 },
            { id: 'foundation-proof', name: '证明论', category: 'foundation', time: 4, x: 4, y: -3 },
            { id: 'foundation-model', name: '模型论', category: 'foundation', time: 5, x: 5, y: -3 },
            { id: 'foundation-recursion', name: '递归论', category: 'foundation', time: 5, x: 5, y: -3.2 },
            
            // 21世纪基础数学新发展
            { id: 'foundation-hott', name: '同伦类型论', category: '21st-century', time: 6, x: 6, y: -3 },
            { id: 'foundation-infinity-cat', name: '无穷范畴', category: '21st-century', time: 6, x: 6, y: -3.2 },
            { id: 'foundation-topos', name: '拓扑斯理论', category: '21st-century', time: 6, x: 6, y: -2.8 },
            { id: 'foundation-etcs', name: 'ETCS', category: '21st-century', time: 6, x: 6.5, y: -3.1 },
            
            // 几何分支
            { id: 'geo-euclidean', name: '欧氏几何', category: 'geometry', time: 0, x: 0, y: 3 },
            { id: 'geo-descriptive', name: '画法几何', category: 'geometry', time: 2, x: 2, y: 3 },
            { id: 'geo-non-euclidean', name: '非欧几何', category: 'geometry', time: 3, x: 3, y: 3.2 },
            { id: 'geo-projective', name: '射影几何', category: 'geometry', time: 3, x: 3, y: 2.8 },
            { id: 'geo-diff-geo', name: '微分几何', category: 'geometry', time: 3, x: 3, y: 3.4 },
            { id: 'geo-alg-topology', name: '代数拓扑', category: 'geometry', time: 4, x: 4, y: 3 },
            { id: 'geo-homotopy', name: '同伦论', category: 'geometry', time: 4, x: 4, y: 3.3 },
            { id: 'geo-homology', name: '同调论', category: 'geometry', time: 4, x: 4, y: 2.7 },
            { id: 'geo-diff-topology', name: '微分拓扑', category: 'geometry', time: 5, x: 5, y: 3.2 },
            { id: 'geo-graph-theory', name: '图论', category: 'geometry', time: 5, x: 5, y: 2.8 },
            { id: 'geo-knot', name: '纽结理论', category: 'geometry', time: 5, x: 5, y: 3.4 },
            
            // 21世纪几何新发展
            { id: 'geo-iut', name: '宇宙际Teichmüller理论', category: '21st-century', time: 6, x: 6, y: 3.2 },
            { id: 'geo-anabelian', name: '远阿贝尔几何', category: '21st-century', time: 6, x: 6, y: 2.8 },
            
            // 代数分支
            { id: 'alg-analytic', name: '解析几何', category: 'algebra', time: 1, x: 1, y: 1 },
            { id: 'alg-number', name: '数论', category: 'algebra', time: 2, x: 2, y: 1 },
            { id: 'alg-group', name: '群论', category: 'algebra', time: 3, x: 3, y: 1.4 },
            { id: 'alg-linear', name: '线性代数', category: 'algebra', time: 3, x: 3, y: 1 },
            { id: 'alg-boolean', name: '布尔代数', category: 'algebra', time: 3, x: 3, y: 0.6 },
            { id: 'alg-alg-geo', name: '代数几何', category: 'algebra', time: 3, x: 3, y: 1.2 },
            { id: 'alg-set', name: '集合论', category: 'algebra', time: 3, x: 3, y: 0.8 },
            { id: 'alg-abstract', name: '抽象代数', category: 'algebra', time: 4, x: 4, y: 1.2 },
            { id: 'alg-game', name: '博弈论', category: 'algebra-cross', time: 4, x: 4, y: 0.8 },
            { id: 'alg-category', name: '范畴论', category: 'algebra', time: 5, x: 5, y: 1.4 },
            { id: 'alg-combinatorics', name: '组合数学', category: 'algebra', time: 5, x: 5, y: 0.6 },
            { id: 'alg-crypto', name: '密码学', category: 'algebra-cross', time: 5, x: 5, y: 1.6 },
            
            // 21世纪代数新发展
            { id: 'alg-homological', name: '同调代数', category: '21st-century', time: 6, x: 6, y: 1.2 },
            { id: 'alg-k-theory', name: 'K-理论', category: '21st-century', time: 6, x: 6, y: 0.8 },
            
            // 分析分支
            { id: 'ana-probability', name: '概率论', category: 'analysis-cross', time: 1, x: 1, y: -1 },
            { id: 'ana-calculus', name: '微积分', category: 'analysis', time: 1, x: 1, y: -1.4 },
            { id: 'ana-variational', name: '变分法', category: 'analysis', time: 2, x: 2, y: -1 },
            { id: 'ana-function', name: '函数论', category: 'analysis', time: 2, x: 2, y: -1.4 },
            { id: 'ana-statistics', name: '统计学', category: 'analysis-cross', time: 2, x: 2, y: -1.8 },
            { id: 'ana-real', name: '实分析', category: 'analysis', time: 3, x: 3, y: -1.2 },
            { id: 'ana-complex', name: '复分析', category: 'analysis', time: 3, x: 3, y: -1.6 },
            { id: 'ana-pde', name: '偏微分方程', category: 'analysis', time: 3, x: 3, y: -2.0 },
            { id: 'ana-functional', name: '泛函分析', category: 'analysis', time: 4, x: 4, y: -1.2 },
            { id: 'ana-measure', name: '测度论', category: 'analysis', time: 4, x: 4, y: -1.6 },
            { id: 'ana-prob-axiom', name: '概率论公理化', category: 'analysis-cross', time: 4, x: 4, y: -2.0 },
            { id: 'ana-dynamical', name: '动力系统', category: 'analysis-cross', time: 5, x: 5, y: -1.2 },
            { id: 'ana-chaos', name: '混沌理论', category: 'analysis-cross', time: 5, x: 5, y: -1.6 },
            { id: 'ana-fractal', name: '分形几何', category: 'analysis-cross', time: 5, x: 5, y: -2.0 },
            { id: 'ana-numerical', name: '数值分析', category: 'analysis-cross', time: 5, x: 5, y: -2.4 },
            { id: 'ana-harmonic', name: '调和分析', category: 'analysis', time: 5, x: 5, y: -2.8 },
            
            // 21世纪分析新发展
            { id: 'ana-nonstandard', name: '非标准分析', category: '21st-century', time: 6, x: 6, y: -1.5 },
            { id: 'ana-nonlinear', name: '非线性数学', category: '21st-century', time: 6, x: 6, y: -2.0 },
            
            // 未解决问题
            { id: 'problem-riemann', name: '黎曼假设', category: 'problem', time: 6, x: 6.5, y: 0.5, symbolSize: 16, itemStyle: { color: '#ff0000' } },
            { id: 'problem-np', name: 'NP问题', category: 'problem', time: 6, x: 6.5, y: 0, symbolSize: 16, itemStyle: { color: '#ff0000' } },
            { id: 'problem-continuum', name: '连续统假设', category: 'problem', time: 6, x: 6.5, y: -0.5, symbolSize: 16, itemStyle: { color: '#ff0000' } },
        ];

        // 定义连接：理论之间的发展/影响关系
        const links = [
            // 基础数学内部连接
            { source: 'foundation-logic', target: 'foundation-set' },
            { source: 'foundation-numbers', target: 'foundation-set' },
            { source: 'foundation-set', target: 'foundation-proof' },
            { source: 'foundation-set', target: 'foundation-model' },
            { source: 'foundation-set', target: 'foundation-recursion' },
            
            // 基础数学到21世纪新发展的连接
            { source: 'foundation-set', target: 'foundation-hott' },
            { source: 'foundation-proof', target: 'foundation-hott' },
            { source: 'foundation-model', target: 'foundation-infinity-cat' },
            { source: 'alg-category', target: 'foundation-infinity-cat' },
            { source: 'foundation-logic', target: 'foundation-topos' },
            { source: 'geo-alg-topology', target: 'foundation-topos' },
            { source: 'foundation-set', target: 'foundation-etcs' },
            { source: 'alg-category', target: 'foundation-etcs' },
            
            // 几何内部连接
            { source: 'geo-euclidean', target: 'geo-descriptive' },
            { source: 'geo-descriptive', target: 'geo-projective' },
            { source: 'geo-projective', target: 'geo-alg-topology' },
            { source: 'geo-non-euclidean', target: 'geo-diff-geo' },
            { source: 'geo-diff-geo', target: 'geo-diff-topology' },
            { source: 'geo-alg-topology', target: 'geo-homotopy' },
            { source: 'geo-alg-topology', target: 'geo-homology' },
            { source: 'geo-alg-topology', target: 'geo-graph-theory' },
            
            // 几何到21世纪新发展的连接
            { source: 'alg-alg-geo', target: 'geo-iut' },
            { source: 'alg-number', target: 'geo-iut' },
            { source: 'geo-alg-topology', target: 'geo-anabelian' },
            { source: 'alg-number', target: 'geo-anabelian' },
            
            // 代数内部连接
            { source: 'alg-analytic', target: 'alg-linear' },
            { source: 'alg-number', target: 'alg-alg-geo' },
            { source: 'alg-group', target: 'alg-abstract' },
            { source: 'alg-abstract', target: 'alg-category' },
            { source: 'alg-boolean', target: 'alg-crypto' },
            { source: 'alg-set', target: 'alg-category' },
            
            // 代数到21世纪新发展的连接
            { source: 'alg-category', target: 'alg-homological' },
            { source: 'alg-abstract', target: 'alg-homological' },
            { source: 'alg-category', target: 'alg-k-theory' },
            { source: 'geo-alg-topology', target: 'alg-k-theory' },
            
            // 分析内部连接
            { source: 'ana-calculus', target: 'ana-variational' },
            { source: 'ana-calculus', target: 'ana-function' },
            { source: 'ana-calculus', target: 'ana-real' },
            { source: 'ana-real', target: 'ana-functional' },
            { source: 'ana-real', target: 'ana-measure' },
            { source: 'ana-probability', target: 'ana-prob-axiom' },
            { source: 'ana-pde', target: 'ana-dynamical' },
            
            // 分析到21世纪新发展的连接
            { source: 'ana-real', target: 'ana-nonstandard' },
            { source: 'foundation-logic', target: 'ana-nonstandard' },
            { source: 'ana-pde', target: 'ana-nonlinear' },
            { source: 'ana-dynamical', target: 'ana-nonlinear' },
            
            // 问题节点的连接
            { source: 'alg-number', target: 'problem-riemann' },
            { source: 'ana-complex', target: 'problem-riemann' },
            { source: 'alg-combinatorics', target: 'problem-np' },
            { source: 'foundation-recursion', target: 'problem-np' },
            { source: 'foundation-set', target: 'problem-continuum' },
            
            // 交叉连接
            { source: 'alg-analytic', target: 'geo-euclidean', lineStyle: { type: 'dashed' } },
            { source: 'ana-probability', target: 'ana-statistics', lineStyle: { type: 'dashed' } },
            { source: 'alg-game', target: 'ana-probability', lineStyle: { type: 'dashed' } },
            { source: 'ana-harmonic', target: 'alg-number', lineStyle: { type: 'dashed' } },
        ];

        // 定义类别样式
        const categories = [
            { name: 'geometry' },
            { name: 'algebra' },
            { name: 'analysis' },
            { name: 'foundation' },
            { name: 'algebra-cross' },
            { name: 'analysis-cross' },
            { name: '21st-century' },
            { name: 'problem' }
        ];

        // 初始化图表
        const chartDom = document.getElementById('main');
        const myChart = echarts.init(chartDom);
        
        let showLabels = true;

        // 根据类别获取颜色
        function getColorByCategory(category) {
            switch (category) {
                case 'geometry': return '#5470c6';
                case 'algebra': return '#91cc75';
                case 'analysis': return '#fac858';
                case 'foundation': return '#6a0dad';
                case 'algebra-cross': return '#ee6666';
                case 'analysis-cross': return '#73c0de';
                case '21st-century': return '#9a60b4';
                case 'problem': return '#ff0000';
                default: return '#9a60b4';
            }
        }

        // 更新图表选项
        function updateChart() {
            const option = {
                tooltip: {
                    formatter: function(params) {
                        if (params.dataType === 'edge') {
                            return `${params.data.source} → ${params.data.target}`;
                        } else {
                            return `<b>${params.data.name}</b><br/>分类: ${params.data.category}`;
                        }
                    }
                },
                animationDurationUpdate: 1500,
                animationEasingUpdate: 'quinticInOut',
                series: [{
                    type: 'graph',
                    layout: 'none',
                    data: nodes.map(function (node) {
                        return {
                            ...node,
                            symbolSize: node.symbolSize || 20,
                            itemStyle: {
                                color: getColorByCategory(node.category)
                            },
                            label: {
                                show: showLabels,
                                position: 'right',
                                formatter: '{b}',
                                fontSize: 12
                            }
                        };
                    }),
                    links: links.map(function(link) {
                        return {
                            ...link,
                            lineStyle: {
                                color: link.lineStyle?.type === 'dashed' ? '#ff9800' : '#aaa',
                                type: link.lineStyle?.type || 'solid',
                                width: 2,
                                curveness: 0.3
                            }
                        };
                    }),
                    roam: true,
                    focusNodeAdjacency: true,
                    lineStyle: {
                        color: 'source',
                        curveness: 0.3,
                        width: 2,
                    },
                    emphasis: {
                        focus: 'adjacency',
                        lineStyle: {
                            width: 4
                        }
                    }
                }]
            };

            myChart.setOption(option, true);
        }

        // 重置视图
        function resetView() {
            myChart.dispatchAction({
                type: 'graphRoam',
                zoom: 1,
                originX: 0,
                originY: 0
            });
        }

        // 切换标签显示
        function toggleLabels() {
            showLabels = !showLabels;
            updateChart();
        }

        // 高亮21世纪新发展
        function highlight21stCentury() {
            const twentyFirstCenturyNodes = nodes.filter(node => node.time === 6);
            twentyFirstCenturyNodes.forEach(node => {
                myChart.dispatchAction({
                    type: 'highlight',
                    seriesIndex: 0,
                    dataIndex: nodes.indexOf(node)
                });
            });
            
            setTimeout(() => {
                alert('21世纪数学新发展已高亮显示（紫色节点）');
            }, 300);
        }

        // 初始化图表
        updateChart();
        
        // 响应窗口大小变化
        window.addEventListener('resize', function() {
            myChart.resize();
        });
    </script>
</body>
</html>